(()=>{"use strict";const e=class{constructor(e,t){this._config=e,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._inputErrorClass=e.inputErrorClass,this._button=t.querySelector(e.buttonSelector),this._buttonDisabledClass=e.buttonDisabledClass,this._form=t,this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}checkSaveButtonAndClearInputs(){this._inputList.forEach((e=>this._hideError(e))),this._checkSaveButton()}_checkSaveButton(){this._form.checkValidity()?(this._button.removeAttribute("disabled"),this._button.classList.remove(this._buttonDisabledClass)):(this._button.setAttribute("disabled","disabled"),this._button.classList.add(this._buttonDisabledClass))}_hideError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent=""}_showError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage}_handleValidator(e){e.validity.valid?this._hideError(e):this._showError(e)}_setFormListeners(){this._form.addEventListener("input",(()=>this._checkSaveButton())),[...this._inputList].forEach((e=>{e.addEventListener("input",(()=>this._handleValidator(e)))}))}enableValidator(){this._setFormListeners()}},t=class{constructor(e){this._popupSelector=e,this._buttonClose=this._popupSelector.querySelector(".popup__close"),this.close=this.close.bind(this),this._cliclHandler=this._cliclHandler.bind(this),this._handlerEscKey=this._handlerEscKey.bind(this)}open(){this._popupSelector.classList.add("popup_active"),document.addEventListener("keydown",this._handlerEscKey)}close(e){e.preventDefault(),this._popupSelector.classList.remove("popup_active"),document.removeEventListener("keydown",this._handlerEscKey)}_handlerEscKey(e){"Escape"==e.code&&this.close(e)}_cliclHandler(e){e.target.classList.contains("popup")&&this.close(e)}setEventListeners(){this._buttonClose.addEventListener("click",this.close),this._popupSelector.addEventListener("click",this._cliclHandler)}},s=class extends t{constructor(e,t){super(e),this._submitForm=t,this._form=this._popupSelector.querySelector(".popup__form"),this._inputs=this._popupSelector.querySelectorAll(".popup__change-line"),this._getInputValues=this.getInputValues.bind(this)}getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}close(e){super.close(e),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",this._submitForm),this._popupSelector.addEventListener("submit",this.close)}},o={place:".place",places:".places",template:".template",popupBigImg:".popup_big-img",formNewPlace:".form-place"},n={formSelector:".popup__form",inputSelector:".popup__change-line",inputErrorClass:"popup__change-line_state_invalid",buttonSelector:".popup__save-button",buttonDisabledClass:"popup__save-button_state_disabled",buttonEditName:".profile__edit-button",buttonAddPlace:".profile__add-button"},i=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),c=(document.querySelectorAll(".popup"),document.querySelectorAll(".popup__close"),document.querySelector(".form-name")),l=document.querySelector(".form-place"),a=document.querySelector(".profile__name"),p=document.querySelector(".profile__occupation"),u=document.querySelector(".popup__name"),d=document.querySelector(".popup__occupation"),_=document.querySelector(".popup-edit"),h=document.querySelector(".popup-add"),m=(document.querySelector(".name-new-place"),document.querySelector(".link-new-place"),document.querySelector(".places")),v=document.querySelector(".template").content,S=document.querySelector(".popup_big-img"),y=new class{constructor({name:e,occupation:t}){this._name=e,this._occupation=t}getUserInfo(){return{name:this._name,occupation:this._occupation}}setUserInfo(e){this._name.textContent=e.name,this._occupation.textContent=e.occupation}}({name:a,occupation:p}),b=new class extends t{open(e,t){super.open();const s=this._popupSelector.querySelector(".popup__big-img");s.src=t,s.alt=e,this._popupSelector.querySelector(".popup__big-img-title").textContent=e}}(S);function f(e,t){b.open(e,t)}b.setEventListeners();const g=new s(_,(function(){y.setUserInfo(g.getInputValues())})),E=new s(h,(function(){const e=E.getInputValues(),t=k(o,e,v,f);L.addItem(t)}));function k(e,t,s,o){return new class{constructor(e,t,s,o){this._config=e,this._item=t,this._view=s.querySelector(this._config.place).cloneNode(!0),this._remove=this._remove.bind(this),this._like=this._like.bind(this),this._openBigImg=o}_remove(){this._view.remove()}_like(e){e.target.classList.toggle("place__like_active")}_setEventListeners(){this._view.querySelector(".place__trash").addEventListener("click",this._remove),this._view.querySelector(".place__like").addEventListener("click",this._like),this._view.querySelector(".place__image").addEventListener("click",(()=>this._openBigImg(this._item.name,this._item.link)))}generateItem(){return this._view.querySelector(".place__title").textContent=this._item.name,this._view.querySelector(".place__image").src=this._item.link,this._view.querySelector(".place__image").alt=this._item.name,this._setEventListeners(),this._view}}(e,t,s,o).generateItem()}g.setEventListeners(),E.setEventListeners(),i.addEventListener("click",(function(){const e=y.getUserInfo();u.value=e.name.textContent,d.value=e.occupation.textContent,q.checkSaveButtonAndClearInputs(),g.open()})),r.addEventListener("click",(function(){w.checkSaveButtonAndClearInputs(),E.open()})),window.addEventListener("load",(()=>{document.querySelectorAll(".popup").forEach((e=>e.classList.add("popup_opacity")))}));const L=new class{constructor({data:e,renderer:t},s){this._renderedItems=e,this._renderer=t,this._container=s}addItem(e){this._container.prepend(e)}renderItems(){this._renderedItems.forEach((e=>{this._renderer(e)}))}}({data:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{const t=k(o,e,v,f);L.addItem(t)}},m);L.renderItems();const q=new e(n,c),w=new e(n,l);q.enableValidator(),w.enableValidator()})();